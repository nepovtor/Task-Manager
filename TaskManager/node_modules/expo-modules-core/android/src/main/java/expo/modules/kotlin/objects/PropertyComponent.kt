package expo.modules.kotlin.objects

import expo.modules.kotlin.AppContext
import expo.modules.kotlin.functions.SyncFunctionComponent
import expo.modules.kotlin.jni.JNIFunctionBody
<<<<<<< HEAD
import expo.modules.kotlin.jni.decorators.JSDecoratorsBridgingObject
=======
import expo.modules.kotlin.jni.JavaScriptModuleObject
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
import expo.modules.kotlin.types.JSTypeConverter

class PropertyComponent(
  /**
   * Name of the property.
   */
  val name: String,

  /**
   * Synchronous function that is called when the property is being accessed.
   */
  val getter: SyncFunctionComponent? = null,

  /**
   * Synchronous function that is called when the property is being set.
   */
  val setter: SyncFunctionComponent? = null
) {
  /**
   * Attaches property to the provided js object.
   */
<<<<<<< HEAD
  fun attachToJSObject(appContext: AppContext, jsObject: JSDecoratorsBridgingObject) {
    val jniGetter = if (getter != null) {
      JNIFunctionBody { args ->
        val result = getter.callUserImplementation(args, appContext)
=======
  fun attachToJSObject(appContext: AppContext, jsObject: JavaScriptModuleObject) {
    val jniGetter = if (getter != null) {
      JNIFunctionBody { args ->
        val result = getter.call(args, appContext)
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        return@JNIFunctionBody JSTypeConverter.convertToJSValue(result)
      }
    } else {
      null
    }

    val jniSetter = if (setter != null) {
      JNIFunctionBody { args ->
<<<<<<< HEAD
        setter.callUserImplementation(args, appContext)
=======
        setter.call(args, appContext)
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        return@JNIFunctionBody null
      }
    } else {
      null
    }

    jsObject.registerProperty(
      name,
<<<<<<< HEAD
      getter?.takesOwner == true,
      getter?.getCppRequiredTypes()?.toTypedArray() ?: emptyArray(),
      jniGetter,
      setter?.takesOwner == true,
=======
      getter?.takesOwner ?: false,
      getter?.getCppRequiredTypes()?.toTypedArray() ?: emptyArray(),
      jniGetter,
      setter?.takesOwner ?: false,
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
      setter?.getCppRequiredTypes()?.toTypedArray() ?: emptyArray(),
      jniSetter
    )
  }
}
