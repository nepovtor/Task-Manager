import sha1 from './lib/sha1';
import v35 from './lib/v35';
import { UUID, Uuidv5Namespace } from './uuid.types';

function uuidv4(): string {
<<<<<<< HEAD
  if (
    // We use this code path in jest-expo.
    process.env.NODE_ENV === 'test' ||
    // Node.js has supported global crypto since v15.
    (typeof crypto === 'undefined' &&
      // Only use abstract imports in server environments.
      typeof window === 'undefined')
  ) {
    // NOTE: Metro statically extracts all `require` statements to resolve them for environments
    // that don't support `require` natively. Here we check if we're running in a server environment
    // by using the standard `typeof window` check, then running `eval` to skip Metro's static
    // analysis and keep the `require` statement intact for runtime evaluation.
    // eslint-disable-next-line no-eval
    return eval('require')('node:crypto').randomUUID();
  }

  return crypto.randomUUID();
=======
  // Crypto needs to be required when run in Node.js environment.
  const cryptoObject =
    typeof crypto === 'undefined' || typeof crypto.randomUUID === 'undefined'
      ? require('crypto')
      : crypto;

  if (!cryptoObject?.randomUUID) {
    throw Error("The browser doesn't support `crypto.randomUUID` function");
  }
  return cryptoObject.randomUUID();
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
}

const uuid: UUID = {
  v4: uuidv4,
  v5: v35('v5', 0x50, sha1),
  namespace: Uuidv5Namespace,
};

export default uuid;
