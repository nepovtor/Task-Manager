"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
<<<<<<< HEAD
    autoAddConfigPluginsAsync: function() {
        return autoAddConfigPluginsAsync;
    },
    getNamedPlugins: function() {
        return getNamedPlugins;
    }
});
function _pluginresolver() {
    const data = require("@expo/config-plugins/build/utils/plugin-resolver");
    _pluginresolver = function() {
=======
    getNamedPlugins: ()=>getNamedPlugins,
    autoAddConfigPluginsAsync: ()=>autoAddConfigPluginsAsync
});
function _pluginResolver() {
    const data = require("@expo/config-plugins/build/utils/plugin-resolver");
    _pluginResolver = function() {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        return data;
    };
    return data;
}
<<<<<<< HEAD
function _prebuildconfig() {
    const data = require("@expo/prebuild-config");
    _prebuildconfig = function() {
=======
function _prebuildConfig() {
    const data = require("@expo/prebuild-config");
    _prebuildConfig = function() {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        return data;
    };
    return data;
}
const _modifyConfigPlugins = require("../../utils/modifyConfigPlugins");
<<<<<<< HEAD
const debug = require('debug')('expo:install:config-plugins');
const AUTO_PLUGINS = (0, _prebuildconfig().getAutoPlugins)();
=======
const debug = require("debug")("expo:install:config-plugins");
const AUTO_PLUGINS = (0, _prebuildConfig().getAutoPlugins)();
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
/**
 * Resolve if a package has a config plugin.
 * For sanity, we'll only support config plugins that use the `app.config.js` entry file,
 * this is because a package like `lodash` could be a "valid" config plugin and break the prebuild process.
 *
 * @param projectRoot
 * @param packageName
 * @returns
 */ function packageHasConfigPlugin(projectRoot, packageName) {
    try {
<<<<<<< HEAD
        const info = (0, _pluginresolver().resolveConfigPluginFunctionWithInfo)(projectRoot, packageName);
=======
        const info = (0, _pluginResolver().resolveConfigPluginFunctionWithInfo)(projectRoot, packageName);
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        if (info.isPluginFile) {
            return info.plugin;
        }
    } catch  {}
    return false;
}
function getNamedPlugins(plugins) {
    const namedPlugins = [];
    for (const plugin of plugins){
        try {
            // @ts-ignore
<<<<<<< HEAD
            const [normal] = (0, _pluginresolver().normalizeStaticPlugin)(plugin);
            if (typeof normal === 'string') {
=======
            const [normal] = (0, _pluginResolver().normalizeStaticPlugin)(plugin);
            if (typeof normal === "string") {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
                namedPlugins.push(normal);
            }
        } catch  {
        // ignore assertions
        }
    }
    return namedPlugins;
}
async function autoAddConfigPluginsAsync(projectRoot, exp, packages) {
<<<<<<< HEAD
    debug('Checking config plugins...');
    const currentPlugins = exp.plugins || [];
    const normalized = getNamedPlugins(currentPlugins);
    debug(`Existing plugins: ${normalized.join(', ')}`);
=======
    debug("Checking config plugins...");
    const currentPlugins = exp.plugins || [];
    const normalized = getNamedPlugins(currentPlugins);
    debug(`Existing plugins: ${normalized.join(", ")}`);
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    const plugins = packages.filter((pkg)=>{
        if (normalized.includes(pkg)) {
            // already included in plugins array
            return false;
        }
        // Check if the package has a valid plugin. Must be a well-made plugin for it to work with this.
        const plugin = packageHasConfigPlugin(projectRoot, pkg);
<<<<<<< HEAD
        debug(`Package "${pkg}" has plugin: ${!!plugin}` + (plugin ? ` (args: ${plugin.length})` : ''));
=======
        debug(`Package "${pkg}" has plugin: ${!!plugin}` + (plugin ? ` (args: ${plugin.length})` : ""));
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        if (AUTO_PLUGINS.includes(pkg)) {
            debug(`Package "${pkg}" is an auto plugin, skipping...`);
            return false;
        }
        return !!plugin;
    });
<<<<<<< HEAD
    await (0, _modifyConfigPlugins.attemptAddingPluginsAsync)(projectRoot, plugins);
=======
    await (0, _modifyConfigPlugins.attemptAddingPluginsAsync)(projectRoot, exp, plugins);
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
}

//# sourceMappingURL=autoAddConfigPlugins.js.map