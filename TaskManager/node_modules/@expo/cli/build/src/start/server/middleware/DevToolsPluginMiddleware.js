"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
<<<<<<< HEAD
    DevToolsPluginEndpoint: function() {
        return _DevToolsPluginManager.DevToolsPluginEndpoint;
    },
    DevToolsPluginMiddleware: function() {
        return DevToolsPluginMiddleware;
    }
});
function _assert() {
    const data = /*#__PURE__*/ _interop_require_default(require("assert"));
=======
    DevToolsPluginEndpoint: ()=>_devToolsPluginManager.DevToolsPluginEndpoint,
    DevToolsPluginMiddleware: ()=>DevToolsPluginMiddleware
});
function _assert() {
    const data = /*#__PURE__*/ _interopRequireDefault(require("assert"));
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    _assert = function() {
        return data;
    };
    return data;
}
function _send() {
<<<<<<< HEAD
    const data = /*#__PURE__*/ _interop_require_default(require("send"));
=======
    const data = /*#__PURE__*/ _interopRequireDefault(require("send"));
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    _send = function() {
        return data;
    };
    return data;
}
<<<<<<< HEAD
const _ExpoMiddleware = require("./ExpoMiddleware");
const _DevToolsPluginManager = require("../DevToolsPluginManager");
function _interop_require_default(obj) {
=======
const _expoMiddleware = require("./ExpoMiddleware");
const _devToolsPluginManager = require("../DevToolsPluginManager");
function _interopRequireDefault(obj) {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
<<<<<<< HEAD
class DevToolsPluginMiddleware extends _ExpoMiddleware.ExpoMiddleware {
    constructor(projectRoot, pluginManager){
        super(projectRoot, [
            _DevToolsPluginManager.DevToolsPluginEndpoint
        ]), this.pluginManager = pluginManager;
    }
    shouldHandleRequest(req) {
        var _req_url;
        if (!((_req_url = req.url) == null ? void 0 : _req_url.startsWith(_DevToolsPluginManager.DevToolsPluginEndpoint))) {
=======
class DevToolsPluginMiddleware extends _expoMiddleware.ExpoMiddleware {
    constructor(projectRoot, pluginManager){
        super(projectRoot, [
            _devToolsPluginManager.DevToolsPluginEndpoint
        ]);
        this.pluginManager = pluginManager;
    }
    shouldHandleRequest(req) {
        var ref;
        if (!((ref = req.url) == null ? void 0 : ref.startsWith(_devToolsPluginManager.DevToolsPluginEndpoint))) {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
            return false;
        }
        return true;
    }
    async handleRequestAsync(req, res) {
<<<<<<< HEAD
        (0, _assert().default)(req.headers.host, 'Request headers must include host');
        const { pathname } = new URL(req.url ?? '/', `http://${req.headers.host}`);
        const pluginName = this.queryPossiblePluginName(pathname.substring(_DevToolsPluginManager.DevToolsPluginEndpoint.length + 1));
=======
        (0, _assert().default)(req.headers.host, "Request headers must include host");
        var _url;
        const { pathname  } = new URL((_url = req.url) != null ? _url : "/", `http://${req.headers.host}`);
        const pluginName = this.queryPossiblePluginName(pathname.substring(_devToolsPluginManager.DevToolsPluginEndpoint.length + 1));
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        const webpageRoot = await this.pluginManager.queryPluginWebpageRootAsync(pluginName);
        if (!webpageRoot) {
            res.statusCode = 404;
            res.end();
            return;
        }
<<<<<<< HEAD
        const pathInPluginRoot = pathname.substring(_DevToolsPluginManager.DevToolsPluginEndpoint.length + pluginName.length + 1) || '/';
=======
        const pathInPluginRoot = pathname.substring(_devToolsPluginManager.DevToolsPluginEndpoint.length + pluginName.length + 1) || "/";
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        (0, _send().default)(req, pathInPluginRoot, {
            root: webpageRoot
        }).pipe(res);
    }
    queryPossiblePluginName(pathname) {
<<<<<<< HEAD
        const parts = pathname.split('/');
        if (parts[0][0] === '@' && parts.length > 1) {
=======
        const parts = pathname.split("/");
        if (parts[0][0] === "@" && parts.length > 1) {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
            // Scoped package name
            return `${parts[0]}/${parts[1]}`;
        }
        return parts[0];
    }
}

//# sourceMappingURL=DevToolsPluginMiddleware.js.map