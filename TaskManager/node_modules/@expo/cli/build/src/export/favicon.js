"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
<<<<<<< HEAD
    getFaviconFromExpoConfigAsync: function() {
        return getFaviconFromExpoConfigAsync;
    },
    getUserDefinedFaviconFile: function() {
        return getUserDefinedFaviconFile;
    },
    getVirtualFaviconAssetsAsync: function() {
        return getVirtualFaviconAssetsAsync;
    }
=======
    getUserDefinedFaviconFile: ()=>getUserDefinedFaviconFile,
    getVirtualFaviconAssetsAsync: ()=>getVirtualFaviconAssetsAsync,
    getFaviconFromExpoConfigAsync: ()=>getFaviconFromExpoConfigAsync
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
});
function _config() {
    const data = require("@expo/config");
    _config = function() {
        return data;
    };
    return data;
}
<<<<<<< HEAD
function _imageutils() {
    const data = require("@expo/image-utils");
    _imageutils = function() {
=======
function _imageUtils() {
    const data = require("@expo/image-utils");
    _imageUtils = function() {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        return data;
    };
    return data;
}
function _fs() {
<<<<<<< HEAD
    const data = /*#__PURE__*/ _interop_require_default(require("fs"));
=======
    const data = /*#__PURE__*/ _interopRequireDefault(require("fs"));
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    _fs = function() {
        return data;
    };
    return data;
}
function _path() {
<<<<<<< HEAD
    const data = /*#__PURE__*/ _interop_require_default(require("path"));
=======
    const data = /*#__PURE__*/ _interopRequireDefault(require("path"));
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    _path = function() {
        return data;
    };
    return data;
}
const _publicFolder = require("./publicFolder");
const _log = require("../log");
<<<<<<< HEAD
function _interop_require_default(obj) {
=======
function _interopRequireDefault(obj) {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
<<<<<<< HEAD
const debug = require('debug')('expo:favicon');
function getUserDefinedFaviconFile(projectRoot) {
    return (0, _publicFolder.getUserDefinedFile)(projectRoot, [
        './favicon.ico'
    ]);
}
async function getVirtualFaviconAssetsAsync(projectRoot, { baseUrl, outputDir, files, exp }) {
    const existing = getUserDefinedFaviconFile(projectRoot);
    if (existing) {
        debug('Using user-defined favicon.ico file.');
=======
const debug = require("debug")("expo:favicon");
function getUserDefinedFaviconFile(projectRoot) {
    return (0, _publicFolder.getUserDefinedFile)(projectRoot, [
        "./favicon.ico"
    ]);
}
async function getVirtualFaviconAssetsAsync(projectRoot, { baseUrl , outputDir , files , exp  }) {
    const existing = getUserDefinedFaviconFile(projectRoot);
    if (existing) {
        debug("Using user-defined favicon.ico file.");
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        return null;
    }
    const data = await getFaviconFromExpoConfigAsync(projectRoot, {
        exp
    });
    if (!data) {
        return null;
    }
    await Promise.all([
        data
    ].map(async (asset)=>{
        const assetPath = _path().default.join(outputDir, asset.path);
        if (files) {
<<<<<<< HEAD
            debug('Storing asset for persisting: ' + assetPath);
            files == null ? void 0 : files.set(asset.path, {
                contents: asset.source,
                targetDomain: 'client'
            });
        } else {
            debug('Writing asset to disk: ' + assetPath);
=======
            debug("Storing asset for persisting: " + assetPath);
            files == null ? void 0 : files.set(asset.path, {
                contents: asset.source,
                targetDomain: "client"
            });
        } else {
            debug("Writing asset to disk: " + assetPath);
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
            await _fs().default.promises.writeFile(assetPath, asset.source);
        }
    }));
    function injectFaviconTag(html) {
<<<<<<< HEAD
        if (!html.includes('</head>')) {
            return html;
        }
        return html.replace('</head>', `<link rel="icon" href="${baseUrl}/favicon.ico" /></head>`);
    }
    return injectFaviconTag;
}
async function getFaviconFromExpoConfigAsync(projectRoot, { force = false, exp = (0, _config().getConfig)(projectRoot).exp } = {}) {
    var _exp_web;
    const src = ((_exp_web = exp.web) == null ? void 0 : _exp_web.favicon) ?? null;
=======
        if (!html.includes("</head>")) {
            return html;
        }
        return html.replace("</head>", `<link rel="shortcut icon" href="${baseUrl}/favicon.ico" /></head>`);
    }
    return injectFaviconTag;
}
async function getFaviconFromExpoConfigAsync(projectRoot, { force =false , exp =(0, _config().getConfig)(projectRoot).exp  } = {}) {
    var ref;
    var ref1;
    const src = (ref1 = (ref = exp.web) == null ? void 0 : ref.favicon) != null ? ref1 : null;
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    if (!src) {
        return null;
    }
    const dims = [
        16,
        32,
        48
    ];
<<<<<<< HEAD
    const cacheType = 'favicon';
    const size = dims[dims.length - 1];
    try {
        const { source } = await (0, _imageutils().generateImageAsync)({
            projectRoot,
            cacheType
        }, {
            resizeMode: 'contain',
            src,
            backgroundColor: 'transparent',
=======
    const cacheType = "favicon";
    const size = dims[dims.length - 1];
    try {
        const { source  } = await (0, _imageUtils().generateImageAsync)({
            projectRoot,
            cacheType
        }, {
            resizeMode: "contain",
            src,
            backgroundColor: "transparent",
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
            width: size,
            height: size,
            name: `favicon-${size}.png`
        });
<<<<<<< HEAD
        const faviconBuffer = await (0, _imageutils().generateFaviconAsync)(source, dims);
        return {
            source: faviconBuffer,
            path: 'favicon.ico'
        };
    } catch (error) {
        // Check for ENOENT
        if (!force && error.code === 'ENOENT') {
=======
        const faviconBuffer = await (0, _imageUtils().generateFaviconAsync)(source, dims);
        return {
            source: faviconBuffer,
            path: "favicon.ico"
        };
    } catch (error) {
        // Check for ENOENT
        if (!force && error.code === "ENOENT") {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
            _log.Log.warn(`Favicon source file in Expo config (web.favicon) does not exist: ${src}`);
            return null;
        }
        throw error;
    }
}

//# sourceMappingURL=favicon.js.map