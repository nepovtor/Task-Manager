"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
<<<<<<< HEAD
    resolveOptionsAsync: function() {
        return resolveOptionsAsync;
    },
    resolvePlatformOption: function() {
        return resolvePlatformOption;
    }
=======
    resolvePlatformOption: ()=>resolvePlatformOption,
    resolveOptionsAsync: ()=>resolveOptionsAsync
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
});
function _config() {
    const data = require("@expo/config");
    _config = function() {
        return data;
    };
    return data;
}
const _platformBundlers = require("../start/server/platformBundlers");
const _errors = require("../utils/errors");
function resolvePlatformOption(exp, platformBundlers, platform = [
<<<<<<< HEAD
    'all'
]) {
    const platformsAvailable = Object.fromEntries(Object.entries(platformBundlers).filter(([platform, bundler])=>{
        var _exp_platforms;
        return bundler === 'metro' && ((_exp_platforms = exp.platforms) == null ? void 0 : _exp_platforms.includes(platform));
=======
    "all"
]) {
    const platformsAvailable = Object.fromEntries(Object.entries(platformBundlers).filter(([platform, bundler])=>{
        var ref;
        return bundler === "metro" && ((ref = exp.platforms) == null ? void 0 : ref.includes(platform));
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    }));
    if (!Object.keys(platformsAvailable).length) {
        throw new _errors.CommandError(`No platforms are configured to use the Metro bundler in the project Expo config.`);
    }
    const assertPlatformBundler = (platform)=>{
        if (!platformsAvailable[platform]) {
<<<<<<< HEAD
            var _exp_platforms, _exp_platforms1;
            if (!((_exp_platforms = exp.platforms) == null ? void 0 : _exp_platforms.includes(platform)) && platform === 'web') {
                // Pass through so the more robust error message is shown.
                return platform;
            }
            throw new _errors.CommandError('BAD_ARGS', `Platform "${platform}" is not configured to use the Metro bundler in the project Expo config, or is missing from the supported platforms in the platforms array: [${(_exp_platforms1 = exp.platforms) == null ? void 0 : _exp_platforms1.join(', ')}].`);
=======
            var ref, ref1;
            if (!((ref = exp.platforms) == null ? void 0 : ref.includes(platform)) && platform === "web") {
                // Pass through so the more robust error message is shown.
                return platform;
            }
            throw new _errors.CommandError("BAD_ARGS", `Platform "${platform}" is not configured to use the Metro bundler in the project Expo config, or is missing from the supported platforms in the platforms array: [${(ref1 = exp.platforms) == null ? void 0 : ref1.join(", ")}].`);
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        }
        return platform;
    };
    const knownPlatforms = [
<<<<<<< HEAD
        'android',
        'ios',
        'web'
    ];
    const assertPlatformIsKnown = (platform)=>{
        if (!knownPlatforms.includes(platform)) {
            throw new _errors.CommandError(`Unsupported platform "${platform}". Options are: ${knownPlatforms.join(',')},all`);
=======
        "android",
        "ios",
        "web"
    ];
    const assertPlatformIsKnown = (platform)=>{
        if (!knownPlatforms.includes(platform)) {
            throw new _errors.CommandError(`Unsupported platform "${platform}". Options are: ${knownPlatforms.join(",")},all`);
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        }
        return platform;
    };
    return platform// Expand `all` to all available platforms.
<<<<<<< HEAD
    .map((platform)=>platform === 'all' ? Object.keys(platformsAvailable) : platform).flat()// Remove duplicated platforms
=======
    .map((platform)=>platform === "all" ? Object.keys(platformsAvailable) : platform).flat()// Remove duplicated platforms
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    .filter((platform, index, list)=>list.indexOf(platform) === index)// Assert platforms are valid
    .map((platform)=>assertPlatformIsKnown(platform)).map((platform)=>assertPlatformBundler(platform));
}
async function resolveOptionsAsync(projectRoot, args) {
<<<<<<< HEAD
    const { exp } = (0, _config().getConfig)(projectRoot, {
=======
    const { exp  } = (0, _config().getConfig)(projectRoot, {
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
        skipPlugins: true,
        skipSDKVersionRequirement: true
    });
    const platformBundlers = (0, _platformBundlers.getPlatformBundlers)(projectRoot, exp);
<<<<<<< HEAD
    const platforms = resolvePlatformOption(exp, platformBundlers, args['--platform']);
    return {
        platforms,
        outputDir: args['--output-dir'] ?? 'dist',
        minify: !args['--no-minify'],
        bytecode: !args['--no-bytecode'],
        clear: !!args['--clear'],
        dev: !!args['--dev'],
        maxWorkers: args['--max-workers'],
        dumpAssetmap: !!args['--dump-assetmap'],
        sourceMaps: !!args['--source-maps'],
        skipSSG: !!args['--no-ssg']
=======
    var ref;
    return {
        platforms: resolvePlatformOption(exp, platformBundlers, args["--platform"]),
        outputDir: (ref = args["--output-dir"]) != null ? ref : "dist",
        minify: !args["--no-minify"],
        bytecode: !args["--no-bytecode"],
        clear: !!args["--clear"],
        dev: !!args["--dev"],
        maxWorkers: args["--max-workers"],
        dumpAssetmap: !!args["--dump-assetmap"],
        sourceMaps: !!args["--source-maps"]
>>>>>>> 0823204efb84884a0322b43e865bb36631ba8251
    };
}

//# sourceMappingURL=resolveOptions.js.map